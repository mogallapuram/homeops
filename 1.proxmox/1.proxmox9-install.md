# üß© Proxmox VE 9 Installation & Post-Setup (HomeOps Edition)

This document covers the complete workflow for setting up **Proxmox VE 9** on a new host, including ISO installation, post-installation configuration, removing the subscription popup, and applying a black theme.

---

## 1Ô∏è‚É£ Download the Proxmox VE 9 ISO

**Official site:**  
üëâ https://www.proxmox.com/en/downloads

Choose:
> **Proxmox VE 9.x ISO Installer**

(Optional) verify checksum:
```bash
sha256sum proxmox-ve_9*.iso
```

---

## 2Ô∏è‚É£ Create Bootable USB (Windows ‚Äì Rufus)

1. Download **Rufus** ‚Üí https://rufus.ie  
2. Insert a USB stick (‚â• 8 GB)  
3. Select:
   - **Boot selection:** `proxmox-ve_9*.iso`  
   - **Partition scheme:** GPT  
   - **Target system:** UEFI  
   - When prompted, pick *DD Image* mode  
4. Click **Start** and wait until finished.

---

## 3Ô∏è‚É£ Install Proxmox VE 9

1. Boot the server from the USB drive.  
2. Select **Install Proxmox VE (Graphical)**.  
3. Accept the license.  
4. Choose the target disk (SSD/NVMe recommended).  
5. Configure:
   - **Location & Keyboard**
   - **Root password** + **Email**
6. Network configuration (example):
   ```
   Hostname: node1.cloud4ram.com
   IP Address: 10.10.10.200/23
   Gateway: 10.10.10.1
   DNS Server: 10.10.10.5     # Pi-hole IP
   ```
7. Click **Install** ‚Üí reboot.

Access after boot:
```
https://10.10.10.200:8006
```
Login:  
`root` / <your password> (Realm: PAM)

---

## 4Ô∏è‚É£ Post-Installation Configuration

SSH into the node:
```bash
ssh root@10.10.10.200
```

# Proxmox 9 - Disable Enterprise Repositories

## Problem
When running `apt update` on Proxmox VE 9, you encounter 401 Unauthorized errors:

```
Err:16 https://enterprise.proxmox.com/debian/ceph-squid trixie InRelease
  401  Unauthorized [IP: 103.76.41.50 443]
Err:17 https://enterprise.proxmox.com/debian/pve trixie InRelease
  401  Unauthorized [IP: 103.76.41.50 443]
```

## Cause
Proxmox VE 9 ships with enterprise repositories enabled by default. These repositories require a paid subscription. Without a valid subscription, you'll get 401 errors.

## Solution
Disable the enterprise repositories and enable the free community repositories.

---

## Quick Fix (One Command)

Run this single command as root to fix everything:

```bash
sed -i 's/^Types:/# Types:/' /etc/apt/sources.list.d/pve-enterprise.sources && \
sed -i 's/^URIs:/# URIs:/' /etc/apt/sources.list.d/pve-enterprise.sources && \
sed -i 's/^Suites:/# Suites:/' /etc/apt/sources.list.d/pve-enterprise.sources && \
sed -i 's/^Components:/# Components:/' /etc/apt/sources.list.d/pve-enterprise.sources && \
sed -i 's/^Signed-By:/# Signed-By:/' /etc/apt/sources.list.d/pve-enterprise.sources && \
sed -i 's/^Types:/# Types:/' /etc/apt/sources.list.d/ceph.sources && \
sed -i 's/^URIs:/# URIs:/' /etc/apt/sources.list.d/ceph.sources && \
sed -i 's/^Suites:/# Suites:/' /etc/apt/sources.list.d/ceph.sources && \
sed -i 's/^Components:/# Components:/' /etc/apt/sources.list.d/ceph.sources && \
sed -i 's/^Signed-By:/# Signed-By:/' /etc/apt/sources.list.d/ceph.sources && \
cat <<EOF > /etc/apt/sources.list.d/pve-no-subscription.sources
Types: deb
URIs: http://download.proxmox.com/debian/pve
Suites: trixie
Components: pve-no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
EOF
cat <<EOF > /etc/apt/sources.list.d/ceph-no-subscription.sources
Types: deb
URIs: http://download.proxmox.com/debian/ceph-squid
Suites: trixie
Components: no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
EOF
apt update
```

---

## Step-by-Step Guide

### Step 1: Disable Enterprise PVE Repository

```bash
sed -i 's/^Types:/# Types:/' /etc/apt/sources.list.d/pve-enterprise.sources
sed -i 's/^URIs:/# URIs:/' /etc/apt/sources.list.d/pve-enterprise.sources
sed -i 's/^Suites:/# Suites:/' /etc/apt/sources.list.d/pve-enterprise.sources
sed -i 's/^Components:/# Components:/' /etc/apt/sources.list.d/pve-enterprise.sources
sed -i 's/^Signed-By:/# Signed-By:/' /etc/apt/sources.list.d/pve-enterprise.sources
```

### Step 2: Disable Enterprise Ceph Repository

```bash
sed -i 's/^Types:/# Types:/' /etc/apt/sources.list.d/ceph.sources
sed -i 's/^URIs:/# URIs:/' /etc/apt/sources.list.d/ceph.sources
sed -i 's/^Suites:/# Suites:/' /etc/apt/sources.list.d/ceph.sources
sed -i 's/^Components:/# Components:/' /etc/apt/sources.list.d/ceph.sources
sed -i 's/^Signed-By:/# Signed-By:/' /etc/apt/sources.list.d/ceph.sources
```

### Step 3: Add Community PVE Repository

```bash
cat <<EOF > /etc/apt/sources.list.d/pve-no-subscription.sources
Types: deb
URIs: http://download.proxmox.com/debian/pve
Suites: trixie
Components: pve-no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
EOF
```

### Step 4: Add Community Ceph Repository

```bash
cat <<EOF > /etc/apt/sources.list.d/ceph-no-subscription.sources
Types: deb
URIs: http://download.proxmox.com/debian/ceph-squid
Suites: trixie
Components: no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg
EOF
```

### Step 5: Update Package Lists

```bash
apt update
```

---

## Verification

After running the commands, you should see a successful update without any 401 errors:

```bash
root@node2:~# apt update
Hit:1 http://deb.debian.org/debian trixie InRelease
Hit:2 http://deb.debian.org/debian trixie-updates InRelease
Hit:3 http://security.debian.org/debian-security trixie-security InRelease
Get:4 http://download.proxmox.com/debian/pve trixie InRelease [3,149 B]
Get:5 http://download.proxmox.com/debian/ceph-squid trixie InRelease [3,182 B]
Fetched 6,331 B in 1s (6,331 B/s)
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
All packages are up to date.
```

---

## What Changed?

### Before:
- **PVE Enterprise**: `https://enterprise.proxmox.com/debian/pve` (requires subscription)
- **Ceph Enterprise**: `https://enterprise.proxmox.com/debian/ceph-squid` (requires subscription)

### After:
- **PVE Community**: `http://download.proxmox.com/debian/pve` (free, no subscription)
- **Ceph Community**: `http://download.proxmox.com/debian/ceph-squid` (free, no subscription)

---

## Important Notes

1. **New .sources Format**: Proxmox 9 uses the DEB822 format (`.sources` files) instead of the old `.list` format.

2. **Community vs Enterprise**:
   - Community repositories are free and suitable for testing and home use
   - Enterprise repositories provide faster updates and official support (requires subscription)

3. **Production Environments**: For production environments, consider purchasing a Proxmox subscription to access enterprise repositories and official support.

4. **Multiple Nodes**: If you have multiple Proxmox nodes in a cluster, repeat these steps on each node.

---

## Troubleshooting

### Check Current Repository Configuration
```bash
ls -la /etc/apt/sources.list.d/
cat /etc/apt/sources.list.d/pve-enterprise.sources
cat /etc/apt/sources.list.d/ceph.sources
```

### Manually Edit Files
If you prefer to edit manually:
```bash
nano /etc/apt/sources.list.d/pve-enterprise.sources
nano /etc/apt/sources.list.d/ceph.sources
```

Add `#` at the beginning of each line to comment them out.

### Remove Repository Files Completely (Alternative)
```bash
rm /etc/apt/sources.list.d/pve-enterprise.sources
rm /etc/apt/sources.list.d/ceph.sources
```

---

## References

- [Proxmox VE Package Repositories](https://pve.proxmox.com/wiki/Package_Repositories)
- [Proxmox VE No-Subscription Repository](https://pve.proxmox.com/wiki/Package_Repositories#sysadmin_no_subscription_repo)

---


## 5Ô∏è‚É£ Update Packages & System

```bash
apt update
apt dist-upgrade -y
apt install -y curl wget net-tools htop ifupdown2
apt autoremove -y && apt clean
```

Restart the web UI:
```bash
systemctl restart pveproxy
```

---

## 6Ô∏è‚É£ Remove Subscription Popup (‚úÖ Working Fix)

By default, Proxmox shows a **‚ÄúNo valid subscription‚Äù** popup on login.  
You can safely remove it by editing the JavaScript logic that handles subscription status.

---

### üõ† Steps

1. **Backup the original file first**
   ```bash
   cp /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js       /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js.bak.$(date +%F-%H%M)
   ```

2. **Edit the file**
   ```bash
   nano /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js
   ```

3. **Find these lines (use Ctrl + W ‚Üí search for `res.data.status.toLowerCase`)**
   You should see something like:
   ```js
   res.data.status.toLowerCase() !== 'active'
   ```

4. **Change it to the following:**
   ```js
   res.data.status.toLowerCase() === 'active'
   ```

5. **Save and restart the proxy**
   ```bash
   systemctl restart pveproxy
   ```

6. **Clear your browser cache or open in Incognito**
   Press `Ctrl + Shift + R` (hard refresh) to reload the updated UI.

‚úÖ This change correctly disables the popup and keeps the Proxmox web interface stable.  
If you ever need to revert, restore from your backup:
```bash
cp /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js.bak.*    /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js
systemctl restart pveproxy
```

---

## 7Ô∏è‚É£ Verify Setup

```bash
pveversion
pvecm status
systemctl status pvedaemon
```

Example output:
```
pve-manager/9.x-1 (Trixie)
```

Access web UI:
```
https://10.10.10.200:8006
```

---

## 8Ô∏è‚É£ Optional ‚Äì Apply a Black Theme (Dark Mode for Proxmox)  ---not working as of nov 7th 2025

If you prefer a modern dark theme for the Proxmox web interface, you can use the **Proxmox-Dark Theme** package by We10X.  
This theme adds a clean black/dark-gray interface and automatically re-applies after updates.

### ‚öôÔ∏è Installation Steps

1. SSH into your Proxmox node:
   ```bash
   ssh root@10.10.10.200
   ```

2. Download and install the theme:
   ```bash
   bash <(curl -s https://raw.githubusercontent.com/We10X/Proxmox-Dark/main/Installer.sh)
   ```

3. Wait for installation to complete ‚Äî it will automatically:
   - Patch Proxmox UI files  
   - Backup originals  
   - Add cron job to persist through updates  

4. Refresh the web UI:
   ```
   https://10.10.10.200:8006
   ```
   üîÅ Press **Ctrl + Shift + R** for a full reload.

### üß© Reverting the Theme
If you want to restore the default Proxmox theme:
```bash
bash <(curl -s https://raw.githubusercontent.com/We10X/Proxmox-Dark/main/Uninstaller.sh)
```

### üåì Notes

- Works perfectly on **Proxmox VE 8.x & 9.x**
- Compatible with **Trixie / Bookworm** base
- Automatically reapplied after upgrades

---

## üß† Summary

| Step | Description |
|------|--------------|
| 1 | Download ISO |
| 2 | Create bootable USB |
| 3 | Install Proxmox VE 9 |
| 4 | Configure repos |
| 5 | Update packages |
| 6 | Remove subscription popup |
| 7 | Verify system |
| 8 | Optional: Apply dark theme |

---

**Author:** Ramakrishna Mogallapu  
**Project:** HomeOps ‚Äî Building a Fully Automated K3s Homelab  
**Proxmox Version:** 9.x (Trixie)  
**Revision:** 1.4  
**Date:** 18 Nov 2025
